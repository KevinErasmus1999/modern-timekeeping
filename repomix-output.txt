This file is a merged representation of the entire codebase, combining all repository files into a single document.
Generated by Repomix on: 2024-11-25T14:13:53.216Z

================================================================
File Summary
================================================================

Purpose:
--------
This file contains a packed representation of the entire repository's contents.
It is designed to be easily consumable by AI systems for analysis, code review,
or other automated processes.

File Format:
------------
The content is organized as follows:
1. This summary section
2. Repository information
3. Repository structure
4. Multiple file entries, each consisting of:
  a. A separator line (================)
  b. The file path (File: path/to/file)
  c. Another separator line
  d. The full contents of the file
  e. A blank line

Usage Guidelines:
-----------------
- This file should be treated as read-only. Any changes should be made to the
  original repository files, not this packed version.
- When processing this file, use the file path to distinguish
  between different files in the repository.
- Be aware that this file may contain sensitive information. Handle it with
  the same level of security as you would the original repository.

Notes:
------
- Some files may have been excluded based on .gitignore rules and Repomix's
  configuration.
- Binary files are not included in this packed representation. Please refer to
  the Repository Structure section for a complete list of file paths, including
  binary files.

Additional Info:
----------------

For more information about Repomix, visit: https://github.com/yamadashy/repomix

================================================================
Repository Structure
================================================================
client/
  public/
    vite.svg
  src/
    assets/
      react.svg
    components/
      Layout.tsx
    context/
      AuthContext.tsx
    pages/
      Dashboard.tsx
      Employees.tsx
      Login.tsx
      Shops.tsx
      TimeEntries.tsx
    routes/
      index.tsx
    App.css
    App.tsx
    index.css
    main.tsx
    vite-env.d.ts
  .gitignore
  eslint.config.js
  index.html
  package.json
  README.md
  tsconfig.app.json
  tsconfig.json
  tsconfig.node.json
  vite.config.ts
server/
  src/
    entities/
      Employee.ts
      Entity.ts
      Shop.ts
      TimeEntry.ts
      User.ts
    middleware/
      auth.ts
      errorHandler.ts
    migrations/
      UpdateEmployeeSchema.ts
    routes/
      auth.ts
      dashboard.ts
      employees.ts
      shops.ts
      timeEntries.ts
    types/
      express/
        index.d.ts
    app.ts
    config.ts
    data-source.ts
    database.ts
  package.json
  tsconfig.json
  typeorm.config.ts
.gitignore

================================================================
Repository Files
================================================================

================
File: client/public/vite.svg
================
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" class="iconify iconify--logos" width="31.88" height="32" preserveAspectRatio="xMidYMid meet" viewBox="0 0 256 257"><defs><linearGradient id="IconifyId1813088fe1fbc01fb466" x1="-.828%" x2="57.636%" y1="7.652%" y2="78.411%"><stop offset="0%" stop-color="#41D1FF"></stop><stop offset="100%" stop-color="#BD34FE"></stop></linearGradient><linearGradient id="IconifyId1813088fe1fbc01fb467" x1="43.376%" x2="50.316%" y1="2.242%" y2="89.03%"><stop offset="0%" stop-color="#FFEA83"></stop><stop offset="8.333%" stop-color="#FFDD35"></stop><stop offset="100%" stop-color="#FFA800"></stop></linearGradient></defs><path fill="url(#IconifyId1813088fe1fbc01fb466)" d="M255.153 37.938L134.897 252.976c-2.483 4.44-8.862 4.466-11.382.048L.875 37.958c-2.746-4.814 1.371-10.646 6.827-9.67l120.385 21.517a6.537 6.537 0 0 0 2.322-.004l117.867-21.483c5.438-.991 9.574 4.796 6.877 9.62Z"></path><path fill="url(#IconifyId1813088fe1fbc01fb467)" d="M185.432.063L96.44 17.501a3.268 3.268 0 0 0-2.634 3.014l-5.474 92.456a3.268 3.268 0 0 0 3.997 3.378l24.777-5.718c2.318-.535 4.413 1.507 3.936 3.838l-7.361 36.047c-.495 2.426 1.782 4.5 4.151 3.78l15.304-4.649c2.372-.72 4.652 1.36 4.15 3.788l-11.698 56.621c-.732 3.542 3.979 5.473 5.943 2.437l1.313-2.028l72.516-144.72c1.215-2.423-.88-5.186-3.54-4.672l-25.505 4.922c-2.396.462-4.435-1.77-3.759-4.114l16.646-57.705c.677-2.35-1.37-4.583-3.769-4.113Z"></path></svg>

================
File: client/src/assets/react.svg
================
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" class="iconify iconify--logos" width="35.93" height="32" preserveAspectRatio="xMidYMid meet" viewBox="0 0 256 228"><path fill="#00D8FF" d="M210.483 73.824a171.49 171.49 0 0 0-8.24-2.597c.465-1.9.893-3.777 1.273-5.621c6.238-30.281 2.16-54.676-11.769-62.708c-13.355-7.7-35.196.329-57.254 19.526a171.23 171.23 0 0 0-6.375 5.848a155.866 155.866 0 0 0-4.241-3.917C100.759 3.829 77.587-4.822 63.673 3.233C50.33 10.957 46.379 33.89 51.995 62.588a170.974 170.974 0 0 0 1.892 8.48c-3.28.932-6.445 1.924-9.474 2.98C17.309 83.498 0 98.307 0 113.668c0 15.865 18.582 31.778 46.812 41.427a145.52 145.52 0 0 0 6.921 2.165a167.467 167.467 0 0 0-2.01 9.138c-5.354 28.2-1.173 50.591 12.134 58.266c13.744 7.926 36.812-.22 59.273-19.855a145.567 145.567 0 0 0 5.342-4.923a168.064 168.064 0 0 0 6.92 6.314c21.758 18.722 43.246 26.282 56.54 18.586c13.731-7.949 18.194-32.003 12.4-61.268a145.016 145.016 0 0 0-1.535-6.842c1.62-.48 3.21-.974 4.76-1.488c29.348-9.723 48.443-25.443 48.443-41.52c0-15.417-17.868-30.326-45.517-39.844Zm-6.365 70.984c-1.4.463-2.836.91-4.3 1.345c-3.24-10.257-7.612-21.163-12.963-32.432c5.106-11 9.31-21.767 12.459-31.957c2.619.758 5.16 1.557 7.61 2.4c23.69 8.156 38.14 20.213 38.14 29.504c0 9.896-15.606 22.743-40.946 31.14Zm-10.514 20.834c2.562 12.94 2.927 24.64 1.23 33.787c-1.524 8.219-4.59 13.698-8.382 15.893c-8.067 4.67-25.32-1.4-43.927-17.412a156.726 156.726 0 0 1-6.437-5.87c7.214-7.889 14.423-17.06 21.459-27.246c12.376-1.098 24.068-2.894 34.671-5.345a134.17 134.17 0 0 1 1.386 6.193ZM87.276 214.515c-7.882 2.783-14.16 2.863-17.955.675c-8.075-4.657-11.432-22.636-6.853-46.752a156.923 156.923 0 0 1 1.869-8.499c10.486 2.32 22.093 3.988 34.498 4.994c7.084 9.967 14.501 19.128 21.976 27.15a134.668 134.668 0 0 1-4.877 4.492c-9.933 8.682-19.886 14.842-28.658 17.94ZM50.35 144.747c-12.483-4.267-22.792-9.812-29.858-15.863c-6.35-5.437-9.555-10.836-9.555-15.216c0-9.322 13.897-21.212 37.076-29.293c2.813-.98 5.757-1.905 8.812-2.773c3.204 10.42 7.406 21.315 12.477 32.332c-5.137 11.18-9.399 22.249-12.634 32.792a134.718 134.718 0 0 1-6.318-1.979Zm12.378-84.26c-4.811-24.587-1.616-43.134 6.425-47.789c8.564-4.958 27.502 2.111 47.463 19.835a144.318 144.318 0 0 1 3.841 3.545c-7.438 7.987-14.787 17.08-21.808 26.988c-12.04 1.116-23.565 2.908-34.161 5.309a160.342 160.342 0 0 1-1.76-7.887Zm110.427 27.268a347.8 347.8 0 0 0-7.785-12.803c8.168 1.033 15.994 2.404 23.343 4.08c-2.206 7.072-4.956 14.465-8.193 22.045a381.151 381.151 0 0 0-7.365-13.322Zm-45.032-43.861c5.044 5.465 10.096 11.566 15.065 18.186a322.04 322.04 0 0 0-30.257-.006c4.974-6.559 10.069-12.652 15.192-18.18ZM82.802 87.83a323.167 323.167 0 0 0-7.227 13.238c-3.184-7.553-5.909-14.98-8.134-22.152c7.304-1.634 15.093-2.97 23.209-3.984a321.524 321.524 0 0 0-7.848 12.897Zm8.081 65.352c-8.385-.936-16.291-2.203-23.593-3.793c2.26-7.3 5.045-14.885 8.298-22.6a321.187 321.187 0 0 0 7.257 13.246c2.594 4.48 5.28 8.868 8.038 13.147Zm37.542 31.03c-5.184-5.592-10.354-11.779-15.403-18.433c4.902.192 9.899.29 14.978.29c5.218 0 10.376-.117 15.453-.343c-4.985 6.774-10.018 12.97-15.028 18.486Zm52.198-57.817c3.422 7.8 6.306 15.345 8.596 22.52c-7.422 1.694-15.436 3.058-23.88 4.071a382.417 382.417 0 0 0 7.859-13.026a347.403 347.403 0 0 0 7.425-13.565Zm-16.898 8.101a358.557 358.557 0 0 1-12.281 19.815a329.4 329.4 0 0 1-23.444.823c-7.967 0-15.716-.248-23.178-.732a310.202 310.202 0 0 1-12.513-19.846h.001a307.41 307.41 0 0 1-10.923-20.627a310.278 310.278 0 0 1 10.89-20.637l-.001.001a307.318 307.318 0 0 1 12.413-19.761c7.613-.576 15.42-.876 23.31-.876H128c7.926 0 15.743.303 23.354.883a329.357 329.357 0 0 1 12.335 19.695a358.489 358.489 0 0 1 11.036 20.54a329.472 329.472 0 0 1-11 20.722Zm22.56-122.124c8.572 4.944 11.906 24.881 6.52 51.026c-.344 1.668-.73 3.367-1.15 5.09c-10.622-2.452-22.155-4.275-34.23-5.408c-7.034-10.017-14.323-19.124-21.64-27.008a160.789 160.789 0 0 1 5.888-5.4c18.9-16.447 36.564-22.941 44.612-18.3ZM128 90.808c12.625 0 22.86 10.235 22.86 22.86s-10.235 22.86-22.86 22.86s-22.86-10.235-22.86-22.86s10.235-22.86 22.86-22.86Z"></path></svg>

================
File: client/src/components/Layout.tsx
================
import React from 'react';
import { Outlet, useNavigate } from 'react-router-dom';
import { useAuth } from '../context/AuthContext';
import {
  Box,
  Drawer,
  List,
  ListItemButton,
  ListItemIcon,
  ListItemText,
  Toolbar,
  Typography,
  useTheme,
  Divider
} from '@mui/material';
import {
  Dashboard,
  People,
  AccessTime,
  Store as StoreIcon,
  Logout as LogoutIcon
} from '@mui/icons-material';

const DRAWER_WIDTH = 240;

const menuItems = [
  { text: 'Dashboard', Icon: Dashboard, path: '/' },
  { text: 'Employees', Icon: People, path: '/employees' },
  { text: 'Time Entries', Icon: AccessTime, path: '/time-entries' },
  { text: 'Shops', Icon: StoreIcon, path: '/shops' }
];

const Layout = () => {
  const navigate = useNavigate();
  const { logout } = useAuth();
  const theme = useTheme();

  return (
    <Box sx={{ display: 'flex' }}>
      <Drawer
        variant="permanent"
        sx={{
          width: DRAWER_WIDTH,
          flexShrink: 0,
          '& .MuiDrawer-paper': {
            width: DRAWER_WIDTH,
            boxSizing: 'border-box',
          },
        }}
      >
        <Toolbar sx={{ px: 2 }}>
          <Typography variant="h6" component="div" sx={{ color: 'white' }}>
            ZAFinance
          </Typography>
        </Toolbar>
        <Divider sx={{ borderColor: 'rgba(255, 255, 255, 0.12)' }} />
        <Box sx={{ overflow: 'auto' }}>
          <List>
            {menuItems.map((item) => (
              <ListItemButton
                key={item.text}
                onClick={() => navigate(item.path)}
                selected={window.location.pathname === item.path}
              >
                <ListItemIcon>
                  <item.Icon />
                </ListItemIcon>
                <ListItemText primary={item.text} />
              </ListItemButton>
            ))}
          </List>
          <Divider sx={{ borderColor: 'rgba(255, 255, 255, 0.12)' }} />
          <List>
            <ListItemButton onClick={logout}>
              <ListItemIcon>
                <LogoutIcon />
              </ListItemIcon>
              <ListItemText primary="Logout" />
            </ListItemButton>
          </List>
        </Box>
      </Drawer>
      <Box
  component="main"
  sx={{
    flexGrow: 1,
    p: 4,  // Increased padding
    backgroundColor: theme.palette.background.default,
    minHeight: '100vh',
    width: `calc(100vw - ${DRAWER_WIDTH}px)` // Full width minus drawer
  }}
>
  <Outlet />
</Box>
    </Box>
  );
};

export default Layout;

================
File: client/src/context/AuthContext.tsx
================
import React, { createContext, useState, useContext, useEffect } from 'react';
import { useNavigate } from 'react-router-dom';

interface AuthContextType {
  isAuthenticated: boolean;
  login: (token: string) => void;
  logout: () => void;
}

const AuthContext = createContext<AuthContextType | null>(null);

export function AuthProvider({ children }: { children: React.ReactNode }) {
  const [isAuthenticated, setIsAuthenticated] = useState(false);
  const navigate = useNavigate();

  useEffect(() => {
    const token = localStorage.getItem('token');
    if (token) {
      setIsAuthenticated(true);
    }
  }, []);

  const login = (token: string) => {
    localStorage.setItem('token', token);
    setIsAuthenticated(true);
  };

  const logout = () => {
    localStorage.removeItem('token');
    setIsAuthenticated(false);
    navigate('/login');
  };

  return (
    <AuthContext.Provider value={{ isAuthenticated, login, logout }}>
      {children}
    </AuthContext.Provider>
  );
}

export const useAuth = () => {
  const context = useContext(AuthContext);
  if (!context) {
    throw new Error('useAuth must be used within an AuthProvider');
  }
  return context;
};

================
File: client/src/pages/Dashboard.tsx
================
import React, { useState, useEffect } from 'react';
import {
  Box,
  Grid,
  Paper,
  Typography,
  FormControl,
  InputLabel,
  Select,
  MenuItem,
  Card,
  CardContent
} from '@mui/material';
import {
  People,
  Store,
  TrendingUp,
  Assessment,
  Warning,
  CheckCircle
} from '@mui/icons-material';
import {
  LineChart,
  Line,
  XAxis,
  YAxis,
  CartesianGrid,
  Tooltip,
  ResponsiveContainer,
  BarChart,
  Bar,
  PieChart,
  Pie,
  Cell
} from 'recharts';

interface DashboardStats {
  totalEmployees: number;
  activeEmployees: number;
  totalShops: number;
  averageHourlyRate: number;
  employeesByShop: {
    shopName: string;
    employeeCount: number;
  }[];
  attendanceStats: {
    present: number;
    absent: number;
    late: number;
  };
  monthlyHours: {
    shop: string;
    hours: number;
  }[];
  recentDocuments: {
    employeeName: string;
    documentType: string;
    uploadDate: string;
  }[];
  shopPerformance: {
    shopName: string;
    totalHours: number;
    employeeCount: number;
    averageRate: number;
  }[];
}

export default function Dashboard() {
  const [dateRange, setDateRange] = useState('month');
  const [stats, setStats] = useState<DashboardStats | null>(null);

  useEffect(() => {
    fetchDashboardData();
  }, [dateRange]);

  const fetchDashboardData = async () => {
    try {
      const token = localStorage.getItem('token');
      const response = await fetch(`/api/dashboard?range=${dateRange}`, {
        headers: {
          'Authorization': `Bearer ${token}`
        }
      });

      if (!response.ok) throw new Error('Failed to fetch dashboard data');

      const data = await response.json();
      setStats(data);
    } catch (error) {
      console.error('Failed to fetch dashboard data:', error);
    } finally {
      setLoading(false);
    }
  };

  if (loading || !stats) return <div>Loading...</div>;

  const COLORS = ['#0088FE', '#00C49F', '#FFBB28', '#FF8042'];

  return (
    <Box sx={{ width: '100%' }}>
      <Box sx={{
        display: 'flex',
        justifyContent: 'space-between',
        alignItems: 'center',
        mb: 4
      }}>
        <Typography variant="h5" fontWeight={500}>
          Business Overview
        </Typography>
        <FormControl size="small" sx={{ width: 150 }}>
          <InputLabel>Time Range</InputLabel>
          <Select
            value={dateRange}
            label="Time Range"
            onChange={(e) => setDateRange(e.target.value)}
          >
            <MenuItem value="week">This Week</MenuItem>
            <MenuItem value="month">This Month</MenuItem>
            <MenuItem value="quarter">This Quarter</MenuItem>
            <MenuItem value="year">This Year</MenuItem>
          </Select>
        </FormControl>
      </Box>

      <Grid container spacing={3}>
        {/* Key Metrics */}
        <Grid item xs={12} md={3}>
          <Paper sx={{ p: 2, bgcolor: 'background.default' }}>
            <Typography variant="h6" color="primary" gutterBottom>
              Workforce Overview
            </Typography>
            <Box sx={{ mt: 2 }}>
              <Typography variant="h3" color="text.primary">
                {stats?.totalEmployees}
              </Typography>
              <Typography variant="body2" color="text.secondary">
                Total Employees
              </Typography>
              <Box sx={{ mt: 2, display: 'flex', alignItems: 'center' }}>
                <CheckCircle color="success" sx={{ mr: 1 }} />
                <Typography variant="body2">
                  {stats?.activeEmployees} Active
                </Typography>
              </Box>
            </Box>
          </Paper>
        </Grid>

        <Grid item xs={12} md={3}>
          <Paper sx={{ p: 2 }}>
            <Typography variant="h6" color="primary" gutterBottom>
              Shop Distribution
            </Typography>
            <Box sx={{ mt: 2 }}>
              <Typography variant="h3">
                {stats?.totalShops}
              </Typography>
              <Typography variant="body2" color="text.secondary">
                Total Locations
              </Typography>
              <Typography variant="body2" color="success.main" sx={{ mt: 1 }}>
                {stats?.employeesByShop.length} Active Shops
              </Typography>
            </Box>
          </Paper>
        </Grid>

        <Grid item xs={12} md={3}>
          <Paper sx={{ p: 2 }}>
            <Typography variant="h6" color="primary" gutterBottom>
              Today's Attendance
            </Typography>
            <Box sx={{ mt: 2 }}>
              <Typography variant="h3" color="success.main">
                {stats?.attendanceStats.present}
              </Typography>
              <Typography variant="body2" color="text.secondary">
                Employees Present
              </Typography>
              <Box sx={{ mt: 1 }}>
                <Typography variant="body2" color="error.main">
                  {stats?.attendanceStats.absent} Absent
                </Typography>
                <Typography variant="body2" color="warning.main">
                  {stats?.attendanceStats.late} Late
                </Typography>
              </Box>
            </Box>
          </Paper>
        </Grid>

        <Grid item xs={12} md={3}>
          <Paper sx={{ p: 2 }}>
            <Typography variant="h6" color="primary" gutterBottom>
              Resource Overview
            </Typography>
            <Box sx={{ mt: 2 }}>
              <Typography variant="h3">
                R{stats?.averageHourlyRate.toFixed(2)}
              </Typography>
              <Typography variant="body2" color="text.secondary">
                Average Hourly Rate
              </Typography>
            </Box>
          </Paper>
        </Grid>

        {/* Staff Distribution Chart */}
        <Grid item xs={12} md={6}>
          <Paper sx={{ p: 2, height: 400 }}>
            <Typography variant="h6" gutterBottom>
              Staff Distribution by Location
            </Typography>
            <ResponsiveContainer>
              <PieChart>
                <Pie
                  data={stats?.employeesByShop}
                  dataKey="employeeCount"
                  nameKey="shopName"
                  cx="50%"
                  cy="50%"
                  outerRadius={100}
                  label
                >
                  {stats?.employeesByShop.map((entry, index) => (
                    <Cell key={index} fill={`hsl(${index * 45}, 70%, 50%)`} />
                  ))}
                </Pie>
                <Tooltip />
              </PieChart>
            </ResponsiveContainer>
          </Paper>
        </Grid>

        {/* Shop Performance */}
        <Grid item xs={12} md={6}>
          <Paper sx={{ p: 2, height: 400 }}>
            <Typography variant="h6" gutterBottom>
              Shop Performance
            </Typography>
            <ResponsiveContainer>
              <BarChart data={stats?.shopPerformance}>
                <CartesianGrid strokeDasharray="3 3" />
                <XAxis dataKey="shopName" />
                <YAxis />
                <Tooltip />
                <Bar dataKey="totalHours" fill="#8884d8" name="Total Hours" />
                <Bar dataKey="employeeCount" fill="#82ca9d" name="Staff Count" />
              </BarChart>
            </ResponsiveContainer>
          </Paper>
        </Grid>

        {/* Recent Documents */}
        <Grid item xs={12}>
          <Paper sx={{ p: 2 }}>
            <Typography variant="h6" gutterBottom>
              Recent Document Updates
            </Typography>
            <Grid container spacing={2}>
              {stats?.recentDocuments.map((doc, index) => (
                <Grid item xs={12} md={3} key={index}>
                  <Card variant="outlined">
                    <CardContent>
                      <Typography variant="subtitle2" color="primary">
                        {doc.employeeName}
                      </Typography>
                      <Typography variant="body2" color="text.secondary">
                        {doc.documentType}
                      </Typography>
                      <Typography variant="caption">
                        {new Date(doc.uploadDate).toLocaleDateString()}
                      </Typography>
                    </CardContent>
                  </Card>
                </Grid>
              ))}
            </Grid>
          </Paper>
        </Grid>
      </Grid>
    </Box>
  );
}

================
File: client/src/pages/Employees.tsx
================
import React, { useState, useEffect } from 'react';
import {
  Box,
  Button,
  Table,
  TableBody,
  TableCell,
  TableContainer,
  TableHead,
  TableRow,
  Paper,
  Typography,
  Dialog,
  DialogTitle,
  DialogContent,
  DialogActions,
  TextField,
  IconButton,
  FormControl,
  InputLabel,
  Select,
  MenuItem,
  ToggleButton,
  ToggleButtonGroup,
  Alert,
  InputAdornment
} from '@mui/material';
import {
  Add as AddIcon,
  Edit as EditIcon,
  Delete as DeleteIcon,
  Search as SearchIcon,
  FileUpload as FileUploadIcon,
  Visibility as VisibilityIcon,
  Male as MaleIcon,
  Female as FemaleIcon
} from '@mui/icons-material';

interface Employee {
  id: number;
  name: string;
  surname: string;
  cellNumber: string;
  email: string;
  idNumber: string;
  gender: 'male' | 'female';
  hourlyRate: number;
  isActive: boolean;
  shopId?: number;
  documents?: string[];
  additionalFields?: Record<string, string>;
}

interface FormData {
  name: string;
  surname: string;
  cellNumber: string;
  email: string;
  idNumber: string;
  gender: 'male' | 'female';
  hourlyRate: number;
  isActive: boolean;
  shopId: number;
  documents: File[];
  additionalFields: { [key: string]: string };
}

interface Shop {
  id: number;
  name: string;
}

const initialFormData: FormData = {
  name: '',
  surname: '',
  cellNumber: '',
  email: '',
  idNumber: '',
  gender: 'male',
  hourlyRate: 0,
  isActive: true,
  shopId: 0,
  documents: [],
  additionalFields: {}
};

const validateEmail = (email: string) => {
  return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
};

const validateCellNumber = (number: string) => {
  return /^(\+27|0)\d{9}$/.test(number);
};

const validateIdNumber = (id: string) => {
  return /^\d{13}$/.test(id);
};

export default function Employees() {
  const [employees, setEmployees] = useState<Employee[]>([]);
  const [filteredEmployees, setFilteredEmployees] = useState<Employee[]>([]);
  const [open, setOpen] = useState(false);
  const [loading, setLoading] = useState(true);
  const [searchTerm, setSearchTerm] = useState('');
  const [statusFilter, setStatusFilter] = useState<string>('all');
  const [editingEmployee, setEditingEmployee] = useState<Employee | null>(null);
  const [formData, setFormData] = useState<FormData>(initialFormData);
  const [formErrors, setFormErrors] = useState<Record<string, string>>({});
  const [error, setError] = useState<string | null>(null);
  const [additionalFieldKey, setAdditionalFieldKey] = useState('');
  const [shops, setShops] = useState<Shop[]>([]);

  useEffect(() => {
    fetchEmployees();
  }, []);

  useEffect(() => {
    filterEmployees();
  }, [employees, searchTerm, statusFilter]);

  useEffect(() => {
    const fetchShops = async () => {
      try {
        const token = localStorage.getItem('token');
        const response = await fetch('/api/shops', {
          headers: {
            'Authorization': `Bearer ${token}`
          }
        });
        const data = await response.json();
        setShops(data);
      } catch (error) {
        console.error('Failed to fetch shops:', error);
      }
    };

    fetchShops();
  }, []);

  const fetchEmployees = async () => {
    try {
      const token = localStorage.getItem('token');
      const response = await fetch('/api/employees', {
        headers: {
          'Authorization': `Bearer ${token}`
        }
      });

      if (!response.ok) {
        throw new Error('Failed to fetch employees');
      }

      const data = await response.json();
      setEmployees(data);
      setFilteredEmployees(data);
      setLoading(false);
    } catch (error) {
      console.error('Failed to fetch employees:', error);
      setError(error instanceof Error ? error.message : 'Failed to fetch employees');
      setLoading(false);
    }
  };

  const validateForm = () => {
    const errors: Record<string, string> = {};

    if (!formData.name.trim()) errors.name = 'Name is required';
    if (!formData.surname.trim()) errors.surname = 'Surname is required';
    if (!formData.cellNumber.trim()) errors.cellNumber = 'Cell number is required';
    else if (!validateCellNumber(formData.cellNumber)) errors.cellNumber = 'Invalid cell number format';

    if (!formData.email.trim()) errors.email = 'Email is required';
    else if (!validateEmail(formData.email)) errors.email = 'Invalid email format';

    if (!formData.idNumber.trim()) errors.idNumber = 'ID number is required';
    else if (!validateIdNumber(formData.idNumber)) errors.idNumber = 'Invalid ID number format';

    if (formData.hourlyRate <= 0) errors.hourlyRate = 'Hourly rate must be greater than 0';

    setFormErrors(errors);
    return Object.keys(errors).length === 0;
  };

  const handleSubmit = async () => {
    if (!validateForm()) {
      return;
    }

    try {
      const token = localStorage.getItem('token');
      const formDataToSend = new FormData();

      // Append basic fields
      Object.entries(formData).forEach(([key, value]) => {
        if (key !== 'documents' && key !== 'additionalFields') {
          formDataToSend.append(key, value.toString());
        }
      });

      // Append additional fields
      Object.entries(formData.additionalFields).forEach(([key, value]) => {
        formDataToSend.append(`additionalFields[${key}]`, value);
      });

      // Append documents
      formData.documents.forEach((doc, index) => {
        formDataToSend.append(`documents`, doc);
      });

      const url = editingEmployee
        ? `/api/employees/${editingEmployee.id}`
        : '/api/employees';

      const response = await fetch(url, {
        method: editingEmployee ? 'PUT' : 'POST',
        headers: {
          'Authorization': `Bearer ${token}`
        },
        body: formDataToSend
      });

      if (!response.ok) {
        throw new Error('Failed to save employee');
      }

      setOpen(false);
      setEditingEmployee(null);
      setFormData(initialFormData);
      fetchEmployees();
    } catch (error) {
      setError(error instanceof Error ? error.message : 'Failed to save employee');
    }
  };

  const handleFileUpload = (event: React.ChangeEvent<HTMLInputElement>) => {
    const files = Array.from(event.target.files || []);
    setFormData(prev => ({
      ...prev,
      documents: [...prev.documents, ...files]
    }));
  };

  const addAdditionalField = () => {
    if (additionalFieldKey.trim()) {
      setFormData(prev => ({
        ...prev,
        additionalFields: {
          ...prev.additionalFields,
          [additionalFieldKey]: ''
        }
      }));
      setAdditionalFieldKey('');
    }
  };

  const filterEmployees = () => {
    let filtered = [...employees];

    if (searchTerm) {
      filtered = filtered.filter(emp =>
        `${emp.name} ${emp.surname}`.toLowerCase().includes(searchTerm.toLowerCase()) ||
        emp.email.toLowerCase().includes(searchTerm.toLowerCase()) ||
        emp.cellNumber.includes(searchTerm)
      );
    }

    if (statusFilter !== 'all') {
      filtered = filtered.filter(emp =>
        statusFilter === 'active' ? emp.isActive : !emp.isActive
      );
    }

    setFilteredEmployees(filtered);
  };

  const DocumentDialog = ({
    open,
    onClose,
    employeeId,
    documents,
    mode
  }: {
    open: boolean;
    onClose: () => void;
    employeeId: number;
    documents: string[];
    mode: 'view' | 'upload';
  }) => {
    const [files, setFiles] = useState<File[]>([]);

    const handleUpload = async () => {
      try {
        const formData = new FormData();
        files.forEach(file => {
          formData.append('documents', file);
        });

        const token = localStorage.getItem('token');
        const response = await fetch(`/api/employees/${employeeId}/documents`, {
          method: 'POST',
          headers: {
            'Authorization': `Bearer ${token}`
          },
          body: formData
        });

        if (response.ok) {
          onClose();
          fetchEmployees(); // Refresh employee list
        }
      } catch (error) {
        console.error('Failed to upload documents:', error);
      }
    };

    const handleDownload = async (documentName: string) => {
      try {
        const token = localStorage.getItem('token');
        const response = await fetch(`/api/employees/documents/${documentName}`, {
          headers: {
            'Authorization': `Bearer ${token}`
          }
        });

        if (response.ok) {
          const blob = await response.blob();
          const url = window.URL.createObjectURL(blob);
          const a = document.createElement('a');
          a.href = url;
          a.download = documentName;
          document.body.appendChild(a);
          a.click();
          document.body.removeChild(a);
          window.URL.revokeObjectURL(url);
        }
      } catch (error) {
        console.error('Failed to download document:', error);
      }
    };

    return (
      <Dialog open={open} onClose={onClose} maxWidth="md" fullWidth>
        <DialogTitle>
          {mode === 'upload' ? 'Upload Documents' : 'View Documents'}
        </DialogTitle>
        <DialogContent>
          {mode === 'upload' ? (
            <Box sx={{ mt: 2 }}>
              <input
                type="file"
                multiple
                onChange={(e) => setFiles(Array.from(e.target.files || []))}
                accept=".pdf,.doc,.docx,.jpg,.jpeg,.png"
              />
              <Box sx={{ mt: 2 }}>
                {files.map((file, index) => (
                  <Box key={index} sx={{ mb: 1 }}>
                    {file.name}
                  </Box>
                ))}
              </Box>
            </Box>
          ) : (
            <List>
              {documents.map((doc, index) => (
                <ListItem key={index}>
                  <ListItemText primary={doc} />
                  <IconButton onClick={() => handleDownload(doc)}>
                    <FileDownloadIcon />
                  </IconButton>
                </ListItem>
              ))}
            </List>
          )}
        </DialogContent>
        <DialogActions>
          <Button onClick={onClose}>Cancel</Button>
          {mode === 'upload' && (
            <Button onClick={handleUpload} variant="contained">
              Upload
            </Button>
          )}
        </DialogActions>
      </Dialog>
    );
  };

  // Update your table actions cell:
  <TableCell>
    <IconButton
      size="small"
      onClick={() => handleEdit(employee)}
      sx={{ mr: 1 }}
    >
      <EditIcon />
    </IconButton>
    <IconButton
      size="small"
      onClick={() => handleDelete(employee.id)}
      color="error"
      sx={{ mr: 1 }}
    >
      <DeleteIcon />
    </IconButton>
    <IconButton
      size="small"
      onClick={() => {
        setSelectedEmployee(employee);
        setDocumentDialogMode('upload');
        setDocumentDialogOpen(true);
      }}
      color="primary"
      sx={{ mr: 1 }}
    >
      <FileUploadIcon />
    </IconButton>
    <IconButton
      size="small"
      onClick={() => {
        setSelectedEmployee(employee);
        setDocumentDialogMode('view');
        setDocumentDialogOpen(true);
      }}
      color="primary"
    >
      <VisibilityIcon />
    </IconButton>
  </TableCell>

  return (
    <Box sx={{ width: '100%' }}>
      {error && (
        <Alert severity="error" sx={{ mb: 2 }} onClose={() => setError(null)}>
          {error}
        </Alert>
      )}

      <Box sx={{
        display: 'flex',
        justifyContent: 'space-between',
        alignItems: 'center',
        mb: 3
      }}>
        <Typography variant="h5" fontWeight={500}>
          Employees
        </Typography>
        <Button
          variant="contained"
          startIcon={<AddIcon />}
          onClick={() => {
            setEditingEmployee(null);
            setFormData(initialFormData);
            setOpen(true);
          }}
        >
          Add Employee
        </Button>
      </Box>

      <Box sx={{ mb: 3, display: 'flex', gap: 2 }}>
        <TextField
          size="small"
          placeholder="Search employees..."
          value={searchTerm}
          onChange={(e) => setSearchTerm(e.target.value)}
          InputProps={{
            startAdornment: (
              <InputAdornment position="start">
                <SearchIcon />
              </InputAdornment>
            ),
          }}
          sx={{ width: 250 }}
        />

        <FormControl size="small" sx={{ width: 200 }}>
          <InputLabel>Status</InputLabel>
          <Select
            value={statusFilter}
            label="Status"
            onChange={(e) => setStatusFilter(e.target.value)}
          >
            <MenuItem value="all">All Status</MenuItem>
            <MenuItem value="active">Active</MenuItem>
            <MenuItem value="inactive">Inactive</MenuItem>
          </Select>
        </FormControl>
      </Box>

      <TableContainer component={Paper}>
        <Table>
          <TableHead>
            <TableRow>
              <TableCell>Name</TableCell>
              <TableCell>Email</TableCell>
              <TableCell>Cell Number</TableCell>
              <TableCell>Gender</TableCell>
              <TableCell>Hourly Rate (ZAR)</TableCell>
              <TableCell>Status</TableCell>
              <TableCell>Actions</TableCell>
            </TableRow>
          </TableHead>
          <TableBody>
            {loading ? (
              <TableRow>
                <TableCell colSpan={7} align="center">Loading...</TableCell>
              </TableRow>
            ) : filteredEmployees.length === 0 ? (
              <TableRow>
                <TableCell colSpan={7} align="center">
                  No employees found
                </TableCell>
              </TableRow>
            ) : (
              filteredEmployees.map((employee) => (
                <TableRow key={employee.id}>
                  <TableCell>{`${employee.name} ${employee.surname}`}</TableCell>
                  <TableCell>{employee.email}</TableCell>
                  <TableCell>{employee.cellNumber}</TableCell>
                  <TableCell>
                    {employee.gender === 'male' ? <MaleIcon /> : <FemaleIcon />}
                  </TableCell>
                  <TableCell>R{employee.hourlyRate.toFixed(2)}</TableCell>
                  <TableCell>
                    <Box
                      sx={{
                        backgroundColor: employee.isActive ? 'success.light' : 'error.light',
                        color: employee.isActive ? 'success.dark' : 'error.dark',
                        px: 1,
                        py: 0.5,
                        borderRadius: 1,
                        display: 'inline-block',
                      }}
                    >
                      {employee.isActive ? 'Active' : 'Inactive'}
                    </Box>
                  </TableCell>
                  <TableCell>
                    <IconButton
                      size="small"
                      onClick={() => {
                        setEditingEmployee(employee);
                        setFormData({
                          ...employee,
                          documents: [],
                          additionalFields: employee.additionalFields || {}
                        });
                        setOpen(true);
                      }}
                    >
                      <EditIcon />
                    </IconButton>
                    <IconButton
                      size="small"
                      color="error"
                      onClick={() => {
                        if (window.confirm('Are you sure you want to delete this employee?')) {
                          // Handle delete
                        }
                      }}
                    >
                      <DeleteIcon />
                    </IconButton>
                  </TableCell>
                </TableRow>
              ))
            )}
          </TableBody>
        </Table>
      </TableContainer>

      <Dialog
        open={open}
        onClose={() => {
          setOpen(false);
          setEditingEmployee(null);
          setFormData(initialFormData);
          setFormErrors({});
        }}
        maxWidth="md"
        fullWidth
      >
        <DialogTitle>
          {editingEmployee ? 'Edit Employee' : 'Add New Employee'}
        </DialogTitle>
        <DialogContent>
          <Box sx={{ pt: 2, display: 'flex', flexDirection: 'column', gap: 2 }}>
            <Box sx={{ display: 'flex', gap: 2 }}>
              <TextField
                label="Name"
                fullWidth
                value={formData.name}
                onChange={(e) => setFormData({ ...formData, name: e.target.value })}
                error={!!formErrors.name}
                helperText={formErrors.name}
              />
              <TextField
                label="Surname"
                fullWidth
                value={formData.surname}
                onChange={(e) => setFormData({ ...formData, surname: e.target.value })}
                error={!!formErrors.surname}
                helperText={formErrors.surname}
              />
            </Box>

            <Box sx={{ display: 'flex', gap: 2 }}>
              <TextField
                label="Email"
                fullWidth
                type="email"
                value={formData.email}
                onChange={(e) => setFormData({ ...formData, email: e.target.value })}
                error={!!formErrors.email}
                helperText={formErrors.email}
              />
              <TextField
                label="Cell Number"
                fullWidth
                value={formData.cellNumber}
                onChange={(e) => setFormData({ ...formData, cellNumber: e.target.value })}
                error={!!formErrors.cellNumber}
                helperText={formErrors.cellNumber}
              />
            </Box>

            <Box sx={{ display: 'flex', gap: 2, alignItems: 'center' }}>
              <TextField
                label="ID Number"
                fullWidth
                value={formData.idNumber}
                onChange={(e) => setFormData({ ...formData, idNumber: e.target.value })}
                error={!!formErrors.idNumber}
                helperText={formErrors.idNumber}
              />
              <TextField
                label="Hourly Rate (ZAR)"
                type="number"
                fullWidth
                value={formData.hourlyRate}
                onChange={(e) => setFormData({ ...formData, hourlyRate: Number(e.target.value) })}
                error={!!formErrors.hourlyRate}
                helperText={formErrors.hourlyRate}
              />
            </Box>

            <Box sx={{ display: 'flex', alignItems: 'center', gap: 2 }}>
              <Typography>Gender:</Typography>
              <ToggleButtonGroup
                value={formData.gender}
                exclusive
                onChange={(_, value) => value && setFormData({ ...formData, gender: value })}
              >
                <ToggleButton value="male">
                  <MaleIcon sx={{ mr: 1 }} /> Male
                </ToggleButton>
                <ToggleButton value="female">
                  <FemaleIcon sx={{ mr: 1 }} /> Female
                </ToggleButton>
              </ToggleButtonGroup>
            </Box>

            {/* Document Upload Section */}
            <Box sx={{ mt: 2 }}>
              <Typography variant="subtitle1" gutterBottom>
                Documents
              </Typography>
              <Box sx={{
                border: '2px dashed',
                borderColor: 'divider',
                borderRadius: 1,
                p: 3,
                textAlign: 'center',
                cursor: 'pointer',
                '&:hover': {
                  borderColor: 'primary.main',
                  bgcolor: 'action.hover'
                }
              }}>
                <input
                  type="file"
                  multiple
                  id="document-upload"
                  style={{ display: 'none' }}
                  onChange={handleFileUpload}
                  accept=".pdf,.doc,.docx,.jpg,.jpeg,.png"
                />
                <label htmlFor="document-upload">
                  <Box sx={{ display: 'flex', flexDirection: 'column', alignItems: 'center' }}>
                    <FileUploadIcon sx={{ fontSize: 40, mb: 1 }} />
                    <Typography variant="body1">
                      Drag & drop files here or click to browse
                    </Typography>
                    <Typography variant="caption" color="textSecondary">
                      Supported formats: PDF, DOC, DOCX, JPG, PNG
                    </Typography>
                  </Box>
                </label>
              </Box>
              {formData.documents.length > 0 && (
                <Box sx={{ mt: 2 }}>
                  <Typography variant="subtitle2" gutterBottom>
                    Selected Files:
                  </Typography>
                  <Box component="ul" sx={{ pl: 2, m: 0 }}>
                    {formData.documents.map((file, index) => (
                      <Box
                        key={index}
                        component="li"
                        sx={{
                          display: 'flex',
                          justifyContent: 'space-between',
                          alignItems: 'center',
                          py: 0.5
                        }}
                      >
                        <Typography variant="body2">{file.name}</Typography>
                        <IconButton
                          size="small"
                          onClick={() => {
                            const newDocs = [...formData.documents];
                            newDocs.splice(index, 1);
                            setFormData({ ...formData, documents: newDocs });
                          }}
                        >
                          <DeleteIcon fontSize="small" />
                        </IconButton>
                      </Box>
                    ))}
                  </Box>
                </Box>
              )}
            </Box>

            {/* Additional Fields Section */}
            <Box sx={{ mt: 2 }}>
              <Typography variant="subtitle1" gutterBottom>
                Additional Fields
              </Typography>
              <Box sx={{ display: 'flex', gap: 1, mb: 2 }}>
                <TextField
                  size="small"
                  label="Field Name"
                  value={additionalFieldKey}
                  onChange={(e) => setAdditionalFieldKey(e.target.value)}
                />
                <Button
                  variant="outlined"
                  onClick={addAdditionalField}
                  disabled={!additionalFieldKey.trim()}
                >
                  Add Field
                </Button>
              </Box>
              {Object.entries(formData.additionalFields).map(([key, value]) => (
                <Box key={key} sx={{ display: 'flex', gap: 1, mb: 1 }}>
                  <TextField
                    fullWidth
                    size="small"
                    label={key}
                    value={value}
                    onChange={(e) => setFormData({
                      ...formData,
                      additionalFields: {
                        ...formData.additionalFields,
                        [key]: e.target.value
                      }
                    })}
                  />
                  <IconButton
                    size="small"
                    onClick={() => {
                      const newFields = { ...formData.additionalFields };
                      delete newFields[key];
                      setFormData({
                        ...formData,
                        additionalFields: newFields
                      });
                    }}
                  >
                    <DeleteIcon />
                  </IconButton>
                </Box>
              ))}
            </Box>
          </Box>
        </DialogContent>
        <DialogActions>
          <Button
            onClick={() => {
              setOpen(false);
              setEditingEmployee(null);
              setFormData(initialFormData);
              setFormErrors({});
            }}
          >
            Cancel
          </Button>
          <Button
            variant="contained"
            onClick={handleSubmit}
            disabled={loading}
          >
            {editingEmployee ? 'Update' : 'Add'} Employee
          </Button>
        </DialogActions>
      </Dialog>
    </Box>
  );
}

================
File: client/src/pages/Login.tsx
================
import React, { useState } from 'react';
import { useNavigate } from 'react-router-dom';
import { Box, Card, CardContent, TextField, Button, Typography, Alert } from '@mui/material';
import { useAuth } from '../context/AuthContext';

export default function Login() {
  const [credentials, setCredentials] = useState({ email: '', password: '' });
  const [error, setError] = useState('');
  const navigate = useNavigate();
  const { login } = useAuth();

  const handleLogin = async (e: React.FormEvent) => {
    e.preventDefault();
    setError('');

    try {
      const res = await fetch('http://localhost:5000/api/auth/login', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(credentials)
      });

      const data = await res.json();

      if (res.ok) {
        login(data.token);
        navigate('/');
      } else {
        setError(data.error || 'Login failed');
      }
    } catch (error) {
      setError('Network error. Please try again.');
    }
  };

  return (
    <Box sx={{ height: '100vh', display: 'flex', alignItems: 'center', justifyContent: 'center', bgcolor: 'grey.100' }}>
      <Card sx={{ minWidth: 300, maxWidth: 400, width: '100%', m: 2 }}>
        <CardContent sx={{ p: 3 }}>
          <Typography variant="h5" gutterBottom align="center">
            Timekeeping Login
          </Typography>
          {error && (
            <Alert severity="error" sx={{ mb: 2 }}>
              {error}
            </Alert>
          )}
          <form onSubmit={handleLogin}>
            <TextField
              fullWidth
              margin="normal"
              label="Email"
              type="email"
              required
              value={credentials.email}
              onChange={e => setCredentials({ ...credentials, email: e.target.value })}
            />
            <TextField
              fullWidth
              margin="normal"
              label="Password"
              type="password"
              required
              value={credentials.password}
              onChange={e => setCredentials({ ...credentials, password: e.target.value })}
            />
            <Button
              fullWidth
              type="submit"
              variant="contained"
              sx={{ mt: 3 }}
            >
              Login
            </Button>
          </form>
        </CardContent>
      </Card>
    </Box>
  );
}

================
File: client/src/pages/Shops.tsx
================
import React, { useState, useEffect } from 'react';
import {
  Box,
  Button,
  Table,
  TableBody,
  TableCell,
  TableContainer,
  TableHead,
  TableRow,
  Paper,
  Typography,
  Dialog,
  DialogTitle,
  DialogContent,
  DialogActions,
  TextField,
  Alert,
  IconButton,
  Switch,
  FormControlLabel
} from '@mui/material';
import AddIcon from '@mui/icons-material/Add';
import EditIcon from '@mui/icons-material/Edit';
import DeleteIcon from '@mui/icons-material/Delete';

interface Employee {
  id: number;
  name: string;
  hourlyRate: number;
  isActive: boolean;
}

interface Shop {
  id: number;
  name: string;
  address: string;
  employeeCount: number;
  isActive: boolean;
  employees?: Employee[];
}

interface FormData {
  name: string;
  address: string;
  isActive: boolean;
}

const initialFormData: FormData = {
  name: '',
  address: '',
  isActive: true
};

export default function Shops() {
  const [shops, setShops] = useState<Shop[]>([]);
  const [open, setOpen] = useState(false);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState<string | null>(null);
  const [editingShop, setEditingShop] = useState<Shop | null>(null);
  const [formData, setFormData] = useState<FormData>(initialFormData);

  useEffect(() => {
    fetchShops();
  }, []);

  const fetchShops = async () => {
    try {
      setLoading(true);
      const token = localStorage.getItem('token');

      if (!token) {
        throw new Error('No authentication token found');
      }

      const response = await fetch('/api/shops', {
        headers: {
          'Authorization': `Bearer ${token}`,
          'Content-Type': 'application/json'
        }
      });

      if (!response.ok) {
        if (response.status === 401) {
          window.location.href = '/login';
          return;
        }
        throw new Error(`HTTP error! status: ${response.status}`);
      }

      const data = await response.json();
      setShops(data);
      setError(null);
    } catch (error) {
      setError(error instanceof Error ? error.message : 'Failed to fetch shops');
    } finally {
      setLoading(false);
    }
  };

  const handleSubmit = async () => {
    try {
      if (!formData.name.trim()) {
        setError('Shop name is required');
        return;
      }

      const token = localStorage.getItem('token');
      if (!token) {
        throw new Error('No authentication token found');
      }

      const url = editingShop
        ? `/api/shops/${editingShop.id}`
        : '/api/shops';

      const response = await fetch(url, {
        method: editingShop ? 'PUT' : 'POST',
        headers: {
          'Content-Type': 'application/json',
          'Authorization': `Bearer ${token}`
        },
        body: JSON.stringify(formData)
      });

      if (!response.ok) {
        throw new Error('Failed to save shop');
      }

      setOpen(false);
      setEditingShop(null);
      setFormData(initialFormData);
      await fetchShops();
      setError(null);
    } catch (error) {
      setError(error instanceof Error ? error.message : 'Failed to save shop');
    }
  };

  const handleEdit = (shop: Shop) => {
    setEditingShop(shop);
    setFormData({
      name: shop.name,
      address: shop.address || '',
      isActive: shop.isActive
    });
    setOpen(true);
  };

  const handleDelete = async (id: number) => {
    if (!window.confirm('Are you sure you want to delete this shop?')) {
      return;
    }

    try {
      const token = localStorage.getItem('token');
      if (!token) {
        throw new Error('No authentication token found');
      }

      const response = await fetch(`/api/shops/${id}`, {
        method: 'DELETE',
        headers: {
          'Authorization': `Bearer ${token}`,
          'Content-Type': 'application/json'
        }
      });

      if (!response.ok) {
        throw new Error('Failed to delete shop');
      }

      await fetchShops();
      setError(null);
    } catch (error) {
      setError(error instanceof Error ? error.message : 'Failed to delete shop');
    }
  };

  return (
    <Box sx={{ width: '100%' }}>
      {error && (
        <Alert severity="error" sx={{ mb: 2 }} onClose={() => setError(null)}>
          {error}
        </Alert>
      )}

      <Box sx={{
        display: 'flex',
        justifyContent: 'space-between',
        alignItems: 'center',
        mb: 4
      }}>
        <Typography variant="h5" fontWeight={500}>
          Shops
        </Typography>
        <Button
          variant="contained"
          startIcon={<AddIcon />}
          onClick={() => {
            setEditingShop(null);
            setFormData(initialFormData);
            setOpen(true);
          }}
        >
          Add Shop
        </Button>
      </Box>

      <TableContainer component={Paper}>
        <Table>
          <TableHead>
            <TableRow>
              <TableCell>Name</TableCell>
              <TableCell>Address</TableCell>
              <TableCell>Employees</TableCell>
              <TableCell>Status</TableCell>
              <TableCell align="right">Actions</TableCell>
            </TableRow>
          </TableHead>
          <TableBody>
            {loading ? (
              <TableRow>
                <TableCell colSpan={5} align="center">Loading...</TableCell>
              </TableRow>
            ) : shops.length === 0 ? (
              <TableRow>
                <TableCell colSpan={5} align="center">
                  No shops found. Add your first shop to get started.
                </TableCell>
              </TableRow>
            ) : (
              shops.map((shop) => (
                <TableRow key={shop.id}>
                  <TableCell>{shop.name}</TableCell>
                  <TableCell>{shop.address}</TableCell>
                  <TableCell>{shop.employeeCount || 0}</TableCell>
                  <TableCell>
                    <Box
                      sx={{
                        backgroundColor: shop.isActive ? 'success.light' : 'error.light',
                        color: shop.isActive ? 'success.dark' : 'error.dark',
                        px: 1,
                        py: 0.5,
                        borderRadius: 1,
                        display: 'inline-block',
                      }}
                    >
                      {shop.isActive ? 'Active' : 'Inactive'}
                    </Box>
                  </TableCell>
                  <TableCell align="right">
                    <IconButton
                      onClick={() => handleEdit(shop)}
                      size="small"
                      sx={{ mr: 1 }}
                    >
                      <EditIcon />
                    </IconButton>
                    <IconButton
                      onClick={() => handleDelete(shop.id)}
                      size="small"
                      color="error"
                    >
                      <DeleteIcon />
                    </IconButton>
                  </TableCell>
                </TableRow>
              ))
            )}
          </TableBody>
        </Table>
      </TableContainer>

      <Dialog
        open={open}
        onClose={() => {
          setOpen(false);
          setEditingShop(null);
          setFormData(initialFormData);
        }}
        maxWidth="sm"
        fullWidth
      >
        <DialogTitle>
          {editingShop ? 'Edit Shop' : 'Add New Shop'}
        </DialogTitle>
        <DialogContent>
          <Box sx={{ pt: 2, display: 'flex', flexDirection: 'column', gap: 2 }}>
            <TextField
              label="Shop Name"
              fullWidth
              required
              value={formData.name}
              onChange={(e) => setFormData({ ...formData, name: e.target.value })}
            />
            <TextField
              label="Address"
              fullWidth
              multiline
              rows={3}
              value={formData.address}
              onChange={(e) => setFormData({ ...formData, address: e.target.value })}
            />
            <FormControlLabel
              control={
                <Switch
                  checked={formData.isActive}
                  onChange={(e) => setFormData({ ...formData, isActive: e.target.checked })}
                />
              }
              label="Active"
            />
          </Box>
        </DialogContent>
        <DialogActions>
          <Button
            onClick={() => {
              setOpen(false);
              setEditingShop(null);
              setFormData(initialFormData);
            }}
          >
            Cancel
          </Button>
          <Button variant="contained" onClick={handleSubmit}>
            {editingShop ? 'Update' : 'Add'} Shop
          </Button>
        </DialogActions>
      </Dialog>
    </Box>
  );
}

================
File: client/src/pages/TimeEntries.tsx
================
import React, { useState, useEffect } from 'react';
import {
  Box,
  Button,
  Table,
  TableBody,
  TableCell,
  TableContainer,
  TableHead,
  TableRow,
  Paper,
  Typography,
  Dialog,
  DialogTitle,
  DialogContent,
  DialogActions,
  FormControl,
  InputLabel,
  Select,
  MenuItem
} from '@mui/material';
import { Add as AddIcon } from '@mui/icons-material';

interface TimeEntry {
  id: number;
  employeeId: number;
  employeeName: string;
  clockIn: string;
  clockOut: string | null;
  earnings: number;
}

interface Employee {
  id: number;
  name: string;
}

export default function TimeEntries() {
  const [entries, setEntries] = useState<TimeEntry[]>([]);
  const [employees, setEmployees] = useState<Employee[]>([]);
  const [selectedEmployee, setSelectedEmployee] = useState<number>(0);
  const [open, setOpen] = useState(false);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    fetchTimeEntries();
    fetchEmployees();
  }, []);

  const fetchTimeEntries = async () => {
    try {
      const token = localStorage.getItem('token');
      const response = await fetch('http://localhost:5000/api/time-entries', {
        headers: {
          'Authorization': `Bearer ${token}`
        }
      });
      const data = await response.json();
      setEntries(data);
      setLoading(false);
    } catch (error) {
      console.error('Failed to fetch time entries:', error);
      setLoading(false);
    }
  };

  const fetchEmployees = async () => {
    try {
      const token = localStorage.getItem('token');
      const response = await fetch('http://localhost:5000/api/employees', {
        headers: {
          'Authorization': `Bearer ${token}`
        }
      });
      const data = await response.json();
      setEmployees(data);
    } catch (error) {
      console.error('Failed to fetch employees:', error);
    }
  };

  const handleClockIn = async () => {
    try {
      const token = localStorage.getItem('token');
      await fetch('http://localhost:5000/api/time-entries', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'Authorization': `Bearer ${token}`
        },
        body: JSON.stringify({
          employeeId: selectedEmployee,
          clockIn: new Date().toISOString()
        })
      });
      setOpen(false);
      setSelectedEmployee(0);
      fetchTimeEntries();
    } catch (error) {
      console.error('Failed to clock in:', error);
    }
  };

  const handleClockOut = async (id: number) => {
    try {
      const token = localStorage.getItem('token');
      await fetch(`http://localhost:5000/api/time-entries/${id}/clock-out`, {
        method: 'PUT',
        headers: {
          'Authorization': `Bearer ${token}`
        }
      });
      fetchTimeEntries();
    } catch (error) {
      console.error('Failed to clock out:', error);
    }
  };

  return (
    <Box sx={{ width: '100%' }}>
      <Box
        sx={{
          display: 'flex',
          justifyContent: 'space-between',
          alignItems: 'center',
          mb: 4
        }}
      >
        <Typography variant="h5" sx={{ fontWeight: 500 }}>
          Time Entries
        </Typography>
        <Button
          variant="contained"
          size="small"
          startIcon={<AddIcon />}
          onClick={() => setOpen(true)}
          sx={{
            textTransform: 'none',
            px: 2,
            py: 1,
            boxShadow: 'none',
            '&:hover': {
              boxShadow: 'none',
            }
          }}
        >
          Clock In
        </Button>
      </Box>

      <TableContainer
        component={Paper}
        sx={{
          boxShadow: 'none',
          border: '1px solid',
          borderColor: 'divider'
        }}
      >
        <Table>
          <TableHead>
            <TableRow>
              <TableCell
                sx={{
                  fontWeight: 600,
                  borderBottom: 2,
                  borderColor: 'primary.main',
                  width: '25%'
                }}
              >
                Employee
              </TableCell>
              <TableCell
                sx={{
                  fontWeight: 600,
                  borderBottom: 2,
                  borderColor: 'primary.main',
                  width: '25%'
                }}
              >
                Clock In
              </TableCell>
              <TableCell
                sx={{
                  fontWeight: 600,
                  borderBottom: 2,
                  borderColor: 'primary.main',
                  width: '25%'
                }}
              >
                Clock Out
              </TableCell>
              <TableCell
                sx={{
                  fontWeight: 600,
                  borderBottom: 2,
                  borderColor: 'primary.main',
                  width: '15%'
                }}
              >
                Earnings
              </TableCell>
              <TableCell
                sx={{
                  fontWeight: 600,
                  borderBottom: 2,
                  borderColor: 'primary.main',
                  width: '10%'
                }}
              >
                Actions
              </TableCell>
            </TableRow>
          </TableHead>
          <TableBody>
            {loading ? (
              <TableRow>
                <TableCell colSpan={5} sx={{ textAlign: 'center', py: 8 }}>
                  Loading...
                </TableCell>
              </TableRow>
            ) : entries.length === 0 ? (
              <TableRow>
                <TableCell colSpan={5} sx={{ textAlign: 'center', py: 8 }}>
                  <Typography color="textSecondary">
                    No time entries found. Clock in an employee to get started.
                  </Typography>
                </TableCell>
              </TableRow>
            ) : (
              entries.map((entry) => (
                <TableRow
                  key={entry.id}
                  sx={{
                    '&:last-child td': { border: 0 },
                    '&:hover': { backgroundColor: 'action.hover' },
                  }}
                >
                  <TableCell>{entry.employeeName}</TableCell>
                  <TableCell>
                    {new Date(entry.clockIn).toLocaleString()}
                  </TableCell>
                  <TableCell>
                    {entry.clockOut
                      ? new Date(entry.clockOut).toLocaleString()
                      : '-'
                    }
                  </TableCell>
                  <TableCell>
                    R{entry.earnings.toFixed(2)}
                  </TableCell>
                  <TableCell>
                    {!entry.clockOut && (
                      <Button
                        variant="contained"
                        color="primary"
                        size="small"
                        onClick={() => handleClockOut(entry.id)}
                        sx={{
                          textTransform: 'none',
                          boxShadow: 'none',
                          '&:hover': {
                            boxShadow: 'none',
                          }
                        }}
                      >
                        Clock Out
                      </Button>
                    )}
                  </TableCell>
                </TableRow>
              ))
            )}
          </TableBody>
        </Table>
      </TableContainer>

      <Dialog
        open={open}
        onClose={() => setOpen(false)}
        maxWidth="sm"
        fullWidth
      >
        <DialogTitle>Clock In Employee</DialogTitle>
        <DialogContent>
          <Box sx={{ pt: 2 }}>
            <FormControl fullWidth>
              <InputLabel>Select Employee</InputLabel>
              <Select
                value={selectedEmployee}
                label="Select Employee"
                onChange={(e) => setSelectedEmployee(Number(e.target.value))}
              >
                <MenuItem value={0} disabled>
                  Select an employee
                </MenuItem>
                {employees.map((employee) => (
                  <MenuItem key={employee.id} value={employee.id}>
                    {employee.name}
                  </MenuItem>
                ))}
              </Select>
            </FormControl>
          </Box>
        </DialogContent>
        <DialogActions>
          <Button
            onClick={() => setOpen(false)}
            sx={{ textTransform: 'none' }}
          >
            Cancel
          </Button>
          <Button
            variant="contained"
            onClick={handleClockIn}
            disabled={!selectedEmployee}
            sx={{
              textTransform: 'none',
              boxShadow: 'none',
              '&:hover': {
                boxShadow: 'none',
              }
            }}
          >
            Clock In
          </Button>
        </DialogActions>
      </Dialog>
    </Box>
  );
}

================
File: client/src/routes/index.tsx
================
import React from 'react';
import { Routes, Route, Navigate } from 'react-router-dom';
import Layout from '../components/Layout';
import Dashboard from '../pages/Dashboard';
import Employees from '../pages/Employees';
import TimeEntries from '../pages/TimeEntries';
import Shops from '../pages/Shops';
import Login from '../pages/Login';

const PrivateRoute: React.FC<{ children: React.ReactNode }> = ({ children }) => {
  const token = localStorage.getItem('token');
  return token ? <>{children}</> : <Navigate to="/login" />;
};

const AppRoutes = () => {
  return (
    <Routes>
      <Route path="/login" element={<Login />} />
      <Route
        path="/"
        element={
          <PrivateRoute>
            <Layout />
          </PrivateRoute>
        }
      >
        <Route index element={<Dashboard />} />
        <Route path="employees" element={<Employees />} />
        <Route path="time-entries" element={<TimeEntries />} />
        <Route path="shops" element={<Shops />} />
      </Route>
    </Routes>
  );
};

export default AppRoutes;

================
File: client/src/App.css
================
#root {
  max-width: 1280px;
  margin: 0 auto;
  padding: 2rem;
  text-align: center;
}

.logo {
  height: 6em;
  padding: 1.5em;
  will-change: filter;
  transition: filter 300ms;
}
.logo:hover {
  filter: drop-shadow(0 0 2em #646cffaa);
}
.logo.react:hover {
  filter: drop-shadow(0 0 2em #61dafbaa);
}

@keyframes logo-spin {
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
}

@media (prefers-reduced-motion: no-preference) {
  a:nth-of-type(2) .logo {
    animation: logo-spin infinite 20s linear;
  }
}

.card {
  padding: 2em;
}

.read-the-docs {
  color: #888;
}

================
File: client/src/App.tsx
================
import React from 'react';
import { BrowserRouter } from 'react-router-dom';
import { createTheme, ThemeProvider, CssBaseline } from '@mui/material';
import { AuthProvider } from './context/AuthContext';
import AppRoutes from './routes'; // We'll create this

const theme = createTheme({
  palette: {
    primary: {
      main: '#1976d2',
    },
    background: {
      default: '#f5f5f5',
      paper: '#ffffff',
    },
  },
  components: {
    MuiDrawer: {
      styleOverrides: {
        paper: {
          width: 240,
          backgroundColor: '#1a237e', // Dark blue sidebar
          color: 'white',
        }
      }
    },
    MuiListItemButton: {
      styleOverrides: {
        root: {
          '&:hover': {
            backgroundColor: 'rgba(255, 255, 255, 0.1)',
          },
          '&.Mui-selected': {
            backgroundColor: 'rgba(255, 255, 255, 0.15)',
          }
        }
      }
    },
    MuiListItemIcon: {
      styleOverrides: {
        root: {
          color: 'white',
        }
      }
    }
  }
});

function App() {
  return (
    <ThemeProvider theme={theme}>
      <CssBaseline />
      <BrowserRouter>
        <AuthProvider>
          <AppRoutes />
        </AuthProvider>
      </BrowserRouter>
    </ThemeProvider>
  );
}

export default App;

================
File: client/src/index.css
================
:root {
  font-family: Inter, system-ui, Avenir, Helvetica, Arial, sans-serif;
  line-height: 1.5;
  font-weight: 400;

  color-scheme: light dark;
  color: rgba(255, 255, 255, 0.87);
  background-color: #242424;

  font-synthesis: none;
  text-rendering: optimizeLegibility;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

a {
  font-weight: 500;
  color: #646cff;
  text-decoration: inherit;
}
a:hover {
  color: #535bf2;
}

body {
  margin: 0;
  display: flex;
  place-items: center;
  min-width: 320px;
  min-height: 100vh;
}

h1 {
  font-size: 3.2em;
  line-height: 1.1;
}

button {
  border-radius: 8px;
  border: 1px solid transparent;
  padding: 0.6em 1.2em;
  font-size: 1em;
  font-weight: 500;
  font-family: inherit;
  background-color: #1a1a1a;
  cursor: pointer;
  transition: border-color 0.25s;
}
button:hover {
  border-color: #646cff;
}
button:focus,
button:focus-visible {
  outline: 4px auto -webkit-focus-ring-color;
}

@media (prefers-color-scheme: light) {
  :root {
    color: #213547;
    background-color: #ffffff;
  }
  a:hover {
    color: #747bff;
  }
  button {
    background-color: #f9f9f9;
  }
}

================
File: client/src/main.tsx
================
import { StrictMode } from 'react'
import { createRoot } from 'react-dom/client'
import './index.css'
import App from './App.tsx'

createRoot(document.getElementById('root')!).render(
  <StrictMode>
    <App />
  </StrictMode>,
)

================
File: client/src/vite-env.d.ts
================
/// <reference types="vite/client" />

================
File: client/.gitignore
================
# Logs
logs
*.log
npm-debug.log*
yarn-debug.log*
yarn-error.log*
pnpm-debug.log*
lerna-debug.log*

node_modules
dist
dist-ssr
*.local

# Editor directories and files
.vscode/*
!.vscode/extensions.json
.idea
.DS_Store
*.suo
*.ntvs*
*.njsproj
*.sln
*.sw?

================
File: client/eslint.config.js
================
import js from '@eslint/js'
import globals from 'globals'
import reactHooks from 'eslint-plugin-react-hooks'
import reactRefresh from 'eslint-plugin-react-refresh'
import tseslint from 'typescript-eslint'

export default tseslint.config(
  { ignores: ['dist'] },
  {
    extends: [js.configs.recommended, ...tseslint.configs.recommended],
    files: ['**/*.{ts,tsx}'],
    languageOptions: {
      ecmaVersion: 2020,
      globals: globals.browser,
    },
    plugins: {
      'react-hooks': reactHooks,
      'react-refresh': reactRefresh,
    },
    rules: {
      ...reactHooks.configs.recommended.rules,
      'react-refresh/only-export-components': [
        'warn',
        { allowConstantExport: true },
      ],
    },
  },
)

================
File: client/index.html
================
<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ZA-Finance</title>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.tsx"></script>
  </body>
</html>

================
File: client/package.json
================
{
  "name": "client",
  "private": true,
  "version": "0.0.0",
  "type": "module",
  "scripts": {
    "dev": "vite --port 5173",
    "build": "tsc && vite build",
    "lint": "eslint . --ext ts,tsx --report-unused-disable-directives --max-warnings 0",
    "preview": "vite preview"
  },
  "dependencies": {
    "@emotion/react": "^11.11.3",
    "@emotion/styled": "^11.11.0",
    "@mui/icons-material": "^5.15.3",
    "@mui/material": "^5.15.3",
    "@types/multer": "^1.4.12",
    "multer": "^1.4.5-lts.1",
    "react": "^18.2.0",
    "react-dom": "^18.2.0",
    "react-router-dom": "^6.21.1",
    "recharts": "^2.10.3"
  },
  "devDependencies": {
    "@types/react": "^18.2.43",
    "@types/react-dom": "^18.2.17",
    "@typescript-eslint/eslint-plugin": "^6.14.0",
    "@typescript-eslint/parser": "^6.14.0",
    "@vitejs/plugin-react": "^4.2.1",
    "eslint": "^8.55.0",
    "eslint-plugin-react-hooks": "^4.6.0",
    "eslint-plugin-react-refresh": "^0.4.5",
    "typescript": "^5.2.2",
    "vite": "^5.0.8"
  }
}

================
File: client/README.md
================
# React + TypeScript + Vite

This template provides a minimal setup to get React working in Vite with HMR and some ESLint rules.

Currently, two official plugins are available:

- [@vitejs/plugin-react](https://github.com/vitejs/vite-plugin-react/blob/main/packages/plugin-react/README.md) uses [Babel](https://babeljs.io/) for Fast Refresh
- [@vitejs/plugin-react-swc](https://github.com/vitejs/vite-plugin-react-swc) uses [SWC](https://swc.rs/) for Fast Refresh

## Expanding the ESLint configuration

If you are developing a production application, we recommend updating the configuration to enable type aware lint rules:

- Configure the top-level `parserOptions` property like this:

```js
export default tseslint.config({
  languageOptions: {
    // other options...
    parserOptions: {
      project: ['./tsconfig.node.json', './tsconfig.app.json'],
      tsconfigRootDir: import.meta.dirname,
    },
  },
})
```

- Replace `tseslint.configs.recommended` to `tseslint.configs.recommendedTypeChecked` or `tseslint.configs.strictTypeChecked`
- Optionally add `...tseslint.configs.stylisticTypeChecked`
- Install [eslint-plugin-react](https://github.com/jsx-eslint/eslint-plugin-react) and update the config:

```js
// eslint.config.js
import react from 'eslint-plugin-react'

export default tseslint.config({
  // Set the react version
  settings: { react: { version: '18.3' } },
  plugins: {
    // Add the react plugin
    react,
  },
  rules: {
    // other rules...
    // Enable its recommended rules
    ...react.configs.recommended.rules,
    ...react.configs['jsx-runtime'].rules,
  },
})
```

================
File: client/tsconfig.app.json
================
{
  "compilerOptions": {
    "tsBuildInfoFile": "./node_modules/.tmp/tsconfig.app.tsbuildinfo",
    "target": "ES2020",
    "useDefineForClassFields": true,
    "lib": ["ES2020", "DOM", "DOM.Iterable"],
    "module": "ESNext",
    "skipLibCheck": true,

    /* Bundler mode */
    "moduleResolution": "Bundler",
    "allowImportingTsExtensions": true,
    "isolatedModules": true,
    "moduleDetection": "force",
    "noEmit": true,
    "jsx": "react-jsx",

    /* Linting */
    "strict": true,
    "noUnusedLocals": true,
    "noUnusedParameters": true,
    "noFallthroughCasesInSwitch": true,
    "noUncheckedSideEffectImports": true
  },
  "include": ["src"]
}

================
File: client/tsconfig.json
================
{
  "files": [],
  "references": [
    { "path": "./tsconfig.app.json" },
    { "path": "./tsconfig.node.json" }
  ]
}

================
File: client/tsconfig.node.json
================
{
  "compilerOptions": {
    "tsBuildInfoFile": "./node_modules/.tmp/tsconfig.node.tsbuildinfo",
    "target": "ES2022",
    "lib": ["ES2023"],
    "module": "ESNext",
    "skipLibCheck": true,

    /* Bundler mode */
    "moduleResolution": "Bundler",
    "allowImportingTsExtensions": true,
    "isolatedModules": true,
    "moduleDetection": "force",
    "noEmit": true,

    /* Linting */
    "strict": true,
    "noUnusedLocals": true,
    "noUnusedParameters": true,
    "noFallthroughCasesInSwitch": true,
    "noUncheckedSideEffectImports": true
  },
  "include": ["vite.config.ts"]
}

================
File: client/vite.config.ts
================
import { defineConfig } from 'vite';
import react from '@vitejs/plugin-react';

export default defineConfig({
  plugins: [react()],
  server: {
    port: 5173,
    proxy: {
      '/api': {
        target: 'http://localhost:5000',
        changeOrigin: true,
        secure: false,
        configure: (proxy, _options) => {
          proxy.on('error', (err, _req, _res) => {
            console.log('proxy error', err);
          });
        }
      }
    }
  }
});

================
File: server/src/entities/Employee.ts
================
import { Entity, PrimaryGeneratedColumn, Column, ManyToOne, OneToMany, CreateDateColumn, UpdateDateColumn } from "typeorm";
import { TimeEntry } from "./TimeEntry";
import { Shop } from "./Shop";

@Entity("employees")
export class Employee {
    @PrimaryGeneratedColumn()
    id!: number;

    @Column()
    name!: string;

    @Column()
    surname!: string;

    @Column()
    email!: string;

    @Column()
    cellNumber!: string;

    @Column()
    idNumber!: string;

    @Column({ default: 'male' })
    gender!: string;

    @Column({ type: 'decimal', precision: 10, scale: 2, default: 0 })
    hourlyRate!: number;

    @Column({ default: true })
    isActive!: boolean;

    @Column({ nullable: true })
    shopId!: number;

    @Column("simple-json", { nullable: true })
    additionalFields!: Record<string, string>;

    @Column("simple-array", { nullable: true })
    documents!: string[];

    @CreateDateColumn()
    createdAt!: Date;

    @UpdateDateColumn()
    updatedAt!: Date;

    @ManyToOne(() => Shop, shop => shop.employees)
    shop!: Shop;

    @OneToMany(() => TimeEntry, timeEntry => timeEntry.employee)
    timeEntries!: TimeEntry[];
}

================
File: server/src/entities/Entity.ts
================
export type BaseEntity = {
    id: number;
    createdAt: Date;
    updatedAt: Date;
}

================
File: server/src/entities/Shop.ts
================
import { Entity, PrimaryGeneratedColumn, Column, OneToMany } from "typeorm";
import { Employee } from "./Employee";

@Entity("shops")
export class Shop {
    @PrimaryGeneratedColumn()
    id!: number;

    @Column()
    name!: string;

    @Column({ nullable: true })
    address!: string;

    @Column({ default: true })
    isActive!: boolean;

    @OneToMany(() => Employee, employee => employee.shop)
    employees!: Employee[];
}

================
File: server/src/entities/TimeEntry.ts
================
import { Entity, PrimaryGeneratedColumn, Column, ManyToOne } from "typeorm";
import { Employee } from "./Employee";

@Entity("time_entries")
export class TimeEntry {
    @PrimaryGeneratedColumn()
    id!: number;

    @ManyToOne(() => Employee, (employee) => employee.timeEntries, { eager: true })
    employee!: Employee;

    @Column()
    clockIn!: Date;

    @Column({ nullable: true })
    clockOut?: Date;

    @Column("decimal", { precision: 10, scale: 2, default: 0 })
    earnings!: number;
}

================
File: server/src/entities/User.ts
================
import { Entity, PrimaryGeneratedColumn, Column } from "typeorm";

@Entity("user")
export class User {
    @PrimaryGeneratedColumn()
    id!: number;

    @Column({ unique: true })
    email!: string;

    @Column()
    password!: string;

    @Column({ default: 'user' })
    role!: 'admin' | 'user';
}

================
File: server/src/middleware/auth.ts
================
import { Router } from 'express';
import bcrypt from 'bcrypt';
import jwt from 'jsonwebtoken';
import { AppDataSource } from '../database';
import { User } from '../entities/User';

const router = Router();
const userRepository = AppDataSource.getRepository(User);

router.post('/login', async (req, res) => {
    try {
        const { email, password } = req.body;

        const user = await userRepository.findOne({
            where: { email }
        });

        if (!user) {
            return res.status(401).json({ error: 'Invalid credentials' });
        }

        const validPassword = await bcrypt.compare(password, user.password);
        if (!validPassword) {
            return res.status(401).json({ error: 'Invalid credentials' });
        }

        const token = jwt.sign(
            { userId: user.id, role: user.role },
            process.env.JWT_SECRET || 'default-secret',
            { expiresIn: process.env.JWT_EXPIRY || '24h' }
        );

        return res.status(200).json({ token });
    } catch (error) {
        console.error('Login error:', error);
        return res.status(500).json({ error: 'Server error' });
    }
});

export default router;

================
File: server/src/middleware/errorHandler.ts
================
import { Request, Response, NextFunction } from 'express';

export const errorHandler = (err: Error, req: Request, res: Response, next: NextFunction) => {
    console.error(err.stack);
    res.status(500).json({ error: 'Something broke!' });
};

================
File: server/src/migrations/UpdateEmployeeSchema.ts
================
import { MigrationInterface, QueryRunner, TableColumn } from "typeorm";

export class UpdateEmployeeSchema1732528257138 implements MigrationInterface {
    public async up(queryRunner: QueryRunner): Promise<void> {
        // Add new columns with nullable true first
        await queryRunner.addColumns("employees", [
            new TableColumn({
                name: "surname",
                type: "varchar",
                isNullable: true,  // Important: Start as nullable
                default: "''"
            }),
            new TableColumn({
                name: "email",
                type: "varchar",
                isNullable: true,
                default: "''"
            }),
            new TableColumn({
                name: "cellNumber",
                type: "varchar",
                isNullable: true,
                default: "''"
            }),
            new TableColumn({
                name: "idNumber",
                type: "varchar",
                isNullable: true,
                default: "''"
            }),
            new TableColumn({
                name: "gender",
                type: "varchar",
                isNullable: true,
                default: "'male'"
            }),
            new TableColumn({
                name: "additionalFields",
                type: "text",
                isNullable: true,
            }),
            new TableColumn({
                name: "documents",
                type: "text",
                isNullable: true,
            })
        ]);

        // Update existing records with default values
        await queryRunner.query(`
            UPDATE employees
            SET surname = '',
                email = '',
                cellNumber = '',
                idNumber = '',
                gender = 'male',
                additionalFields = '{}',
                documents = '[]'
            WHERE surname IS NULL
        `);
    }

    public async down(queryRunner: QueryRunner): Promise<void> {
        // Drop columns in reverse order
        const columns = [
            "documents",
            "additionalFields",
            "gender",
            "idNumber",
            "cellNumber",
            "email",
            "surname"
        ];

        for (const column of columns) {
            if (await queryRunner.hasColumn("employees", column)) {
                await queryRunner.dropColumn("employees", column);
            }
        }
    }
}

================
File: server/src/routes/auth.ts
================
import { Router } from 'express';
import type { Request, Response } from 'express';
import bcrypt from 'bcrypt';
import jwt from 'jsonwebtoken';
import { AppDataSource } from '../database';
import { User } from '../entities/User';

const router = Router();
const userRepository = AppDataSource.getRepository(User);

const register = async (req: Request, res: Response): Promise<void> => {
    try {
        const { email, password, role } = req.body;
        const hashedPassword = await bcrypt.hash(password, 10);

        const user = userRepository.create({
            email,
            password: hashedPassword,
            role: role || 'user'
        });

        await userRepository.save(user);
        res.status(201).json({ message: 'User registered successfully' });
    } catch (error) {
        res.status(500).json({ error: 'Server error' });
    }
};

const login = async (req: Request, res: Response): Promise<void> => {
    try {
        const { email, password } = req.body;
        const user = await userRepository.findOne({ where: { email } });

        if (!user) {
            res.status(401).json({ error: 'Invalid credentials' });
            return;
        }

        const validPassword = await bcrypt.compare(password, user.password);
        if (!validPassword) {
            res.status(401).json({ error: 'Invalid credentials' });
            return;
        }

        const token = jwt.sign(
            { userId: user.id, role: user.role },
            process.env.JWT_SECRET!,
            { expiresIn: process.env.JWT_EXPIRY }
        );

        res.json({ token });
    } catch (error) {
        res.status(500).json({ error: 'Server error' });
    }
};

router.post('/register', register);
router.post('/login', login);

export default router;

================
File: server/src/routes/dashboard.ts
================
import { Router } from 'express';
import { AppDataSource } from '../database';
import { Employee } from '../entities/Employee';
import { TimeEntry } from '../entities/TimeEntry';
import { Shop } from '../entities/Shop';
import { Between, MoreThanOrEqual, LessThanOrEqual } from 'typeorm';
import { auth } from '../middleware/auth';

const router = Router();

router.get('/', auth, async (req, res) => {
    try {
        const { range = 'month' } = req.query;
        const now = new Date();
        let startDate = new Date();

        // Calculate date range
        switch (range) {
            case 'week':
                startDate.setDate(now.getDate() - 7);
                break;
            case 'month':
                startDate.setMonth(now.getMonth() - 1);
                break;
            case 'quarter':
                startDate.setMonth(now.getMonth() - 3);
                break;
            case 'year':
                startDate.setFullYear(now.getFullYear() - 1);
                break;
            default:
                startDate.setMonth(now.getMonth() - 1);
        }

        const [
            employees,
            shops,
            timeEntries,
            documents
        ] = await Promise.all([
            AppDataSource.getRepository(Employee).find({ relations: ['shop'] }),
            AppDataSource.getRepository(Shop).find(),
            AppDataSource.getRepository(TimeEntry).find({
                where: {
                    clockIn: Between(startDate, now)
                },
                relations: ['employee', 'employee.shop']
            }),
            // Assuming you have a Document entity or using the documents field from Employee
            AppDataSource.getRepository(Employee)
                .createQueryBuilder('employee')
                .where('employee.documents IS NOT NULL')
                .orderBy('employee.updatedAt', 'DESC')
                .take(8)
                .getMany()
        ]);

        // Calculate attendance for today
        const todayStart = new Date();
        todayStart.setHours(0, 0, 0, 0);
        const todayEnd = new Date();
        todayEnd.setHours(23, 59, 59, 999);

        const todayEntries = timeEntries.filter(entry =>
            entry.clockIn >= todayStart && entry.clockIn <= todayEnd
        );

        const attendanceStats = {
            present: new Set(todayEntries.map(entry => entry.employee.id)).size,
            absent: employees.length - new Set(todayEntries.map(entry => entry.employee.id)).size,
            late: todayEntries.filter(entry => {
                const clockInHour = new Date(entry.clockIn).getHours();
                return clockInHour >= 9; // Assuming 9 AM is the start time
            }).length
        };

        // Calculate shop performance
        const shopPerformance = shops.map(shop => {
            const shopEmployees = employees.filter(emp => emp.shopId === shop.id);
            const shopEntries = timeEntries.filter(entry => entry.employee.shopId === shop.id);

            const totalHours = shopEntries.reduce((sum, entry) => {
                const clockOut = entry.clockOut || new Date();
                const hours = (clockOut.getTime() - entry.clockIn.getTime()) / (1000 * 60 * 60);
                return sum + hours;
            }, 0);

            return {
                shopName: shop.name,
                totalHours: Math.round(totalHours),
                employeeCount: shopEmployees.length,
                averageRate: shopEmployees.reduce((sum, emp) => sum + emp.hourlyRate, 0) / shopEmployees.length || 0
            };
        });

        // Format recent documents
        const recentDocuments = documents.map(emp => ({
            employeeName: `${emp.name} ${emp.surname}`,
            documentType: 'Employee Document', // You might want to store document types
            uploadDate: emp.updatedAt
        }));

        res.json({
            totalEmployees: employees.length,
            activeEmployees: employees.filter(emp => emp.isActive).length,
            totalShops: shops.length,
            averageHourlyRate: employees.reduce((sum, emp) => sum + emp.hourlyRate, 0) / employees.length,
            employeesByShop: shops.map(shop => ({
                shopName: shop.name,
                employeeCount: employees.filter(emp => emp.shopId === shop.id).length
            })),
            attendanceStats,
            shopPerformance,
            recentDocuments
        });

    } catch (error) {
        console.error('Dashboard error:', error);
        res.status(500).json({ error: 'Failed to fetch dashboard data' });
    }
});

export default router;

================
File: server/src/routes/employees.ts
================
import { Router, Request, Response } from 'express';
import { AppDataSource } from '../database';
import { Employee } from '../entities/Employee';
import { auth } from '../middleware/auth';
import multer from 'multer';
import path from 'path';
import fs from 'fs/promises';

const router = Router();
const employeeRepo = AppDataSource.getRepository(Employee);

// Configure multer for file uploads
const storage = multer.diskStorage({
    destination: async function (req, file, cb) {
        const uploadDir = './uploads/documents';
        try {
            await fs.mkdir(uploadDir, { recursive: true });
            cb(null, uploadDir);
        } catch (error) {
            cb(error as Error, uploadDir);
        }
    },
    filename: function (req, file, cb) {
        const uniqueSuffix = Date.now() + '-' + Math.round(Math.random() * 1E9);
        cb(null, file.fieldname + '-' + uniqueSuffix + path.extname(file.originalname));
    }
});

const upload = multer({
    storage,
    limits: { fileSize: 5 * 1024 * 1024 }, // 5MB
    fileFilter: (req, file, cb) => {
        const allowedTypes = /jpeg|jpg|png|pdf|doc|docx/;
        const extname = allowedTypes.test(path.extname(file.originalname).toLowerCase());
        const mimetype = allowedTypes.test(file.mimetype);
        if (extname && mimetype) {
            return cb(null, true);
        }
        cb(new Error('Invalid file type'));
    }
});

// Get all employees
router.get('/', auth, async (req: Request, res: Response) => {
    try {
        const employees = await employeeRepo.find({
            relations: ['shop'],
            order: { name: 'ASC' }
        });
        res.json(employees);
    } catch (error) {
        console.error('Failed to fetch employees:', error);
        res.status(500).json({ error: 'Failed to fetch employees' });
    }
});

// Create new employee
router.post('/', auth, upload.array('documents'), async (req: Request, res: Response) => {
    try {
        const {
            name,
            surname,
            email,
            cellNumber,
            idNumber,
            gender,
            hourlyRate,
            additionalFields
        } = req.body;

        // Validate required fields
        if (!name || !surname || !email || !cellNumber || !idNumber) {
            return res.status(400).json({ error: 'Required fields are missing' });
        }

        // Handle file uploads
        const files = req.files as Express.Multer.File[] || [];
        const documents = files.map(file => file.filename);

        // Create employee
        const employee = employeeRepo.create({
            name,
            surname,
            email,
            cellNumber,
            idNumber,
            gender: gender || 'male',
            hourlyRate: parseFloat(hourlyRate) || 0,
            documents,
            additionalFields: additionalFields ? JSON.parse(additionalFields) : {},
            isActive: true
        });

        console.log('Creating employee:', employee); // Debug log

        const savedEmployee = await employeeRepo.save(employee);
        console.log('Employee saved:', savedEmployee); // Debug log

        res.status(201).json(savedEmployee);
    } catch (error) {
        console.error('Failed to create employee:', error);
        // Delete uploaded files if employee creation fails
        if (req.files) {
            const files = req.files as Express.Multer.File[];
            for (const file of files) {
                try {
                    await fs.unlink(file.path);
                } catch (unlinkError) {
                    console.error('Failed to delete file:', unlinkError);
                }
            }
        }
        res.status(500).json({
            error: 'Failed to create employee',
            details: error instanceof Error ? error.message : 'Unknown error'
        });
    }
});

// Update employee
router.put('/:id', auth, upload.array('documents'), async (req: Request, res: Response) => {
    try {
        const { id } = req.params;
        const {
            name,
            surname,
            email,
            cellNumber,
            idNumber,
            gender,
            hourlyRate,
            additionalFields,
            isActive
        } = req.body;

        const employee = await employeeRepo.findOne({ where: { id: parseInt(id) } });
        if (!employee) {
            return res.status(404).json({ error: 'Employee not found' });
        }

        // Handle new file uploads
        const files = req.files as Express.Multer.File[] || [];
        const newDocuments = files.map(file => file.filename);

        // Update employee
        Object.assign(employee, {
            name: name || employee.name,
            surname: surname || employee.surname,
            email: email || employee.email,
            cellNumber: cellNumber || employee.cellNumber,
            idNumber: idNumber || employee.idNumber,
            gender: gender || employee.gender,
            hourlyRate: hourlyRate ? parseFloat(hourlyRate) : employee.hourlyRate,
            documents: [...(employee.documents || []), ...newDocuments],
            additionalFields: additionalFields ? JSON.parse(additionalFields) : employee.additionalFields,
            isActive: isActive !== undefined ? isActive : employee.isActive
        });

        await employeeRepo.save(employee);
        res.json(employee);
    } catch (error) {
        console.error('Failed to update employee:', error);
        res.status(500).json({ error: 'Failed to update employee' });
    }
});

// Delete employee
router.delete('/:id', auth, async (req: Request, res: Response) => {
    try {
        const { id } = req.params;
        const employee = await employeeRepo.findOne({ where: { id: parseInt(id) } });

        if (!employee) {
            return res.status(404).json({ error: 'Employee not found' });
        }

        // Delete associated documents
        if (employee.documents) {
            for (const doc of employee.documents) {
                try {
                    await fs.unlink(path.join('./uploads/documents', doc));
                } catch (error) {
                    console.error('Failed to delete document:', error);
                }
            }
        }

        await employeeRepo.remove(employee);
        res.json({ message: 'Employee deleted successfully' });
    } catch (error) {
        console.error('Failed to delete employee:', error);
        res.status(500).json({ error: 'Failed to delete employee' });
    }
});

export default router;

================
File: server/src/routes/shops.ts
================
import { Router } from 'express';
import { Request, Response } from 'express';
import { AppDataSource } from '../database';
import { Shop } from '../entities/Shop';
import { auth } from '../middleware/auth';

const router = Router();
const shopRepository = AppDataSource.getRepository(Shop);

// Get all shops
router.get('/', auth, async (_req: Request, res: Response) => {
    try {
        const shops = await shopRepository
            .createQueryBuilder('shop')
            .leftJoinAndSelect('shop.employees', 'employee')
            .getMany();

        const shopsWithCount = shops.map(shop => ({
            id: shop.id,
            name: shop.name,
            address: shop.address,
            isActive: shop.isActive,
            employeeCount: shop.employees?.length || 0
        }));

        res.status(200).json(shopsWithCount);
    } catch (error) {
        console.error('Failed to fetch shops:', error);
        res.status(500).json({ error: 'Failed to fetch shops' });
    }
});

// Create shop
router.post('/', auth, async (req: Request, res: Response) => {
    try {
        const shop = shopRepository.create(req.body);
        const result = await shopRepository.save(shop);
        res.status(201).json(result);
    } catch (error) {
        res.status(500).json({ error: 'Failed to create shop' });
    }
});

// Update shop
router.put('/:id', auth, async (req: Request, res: Response) => {
    try {
        const shop = await shopRepository.findOne({
            where: { id: parseInt(req.params.id) }
        });

        if (!shop) {
            return res.status(404).json({ error: 'Shop not found' });
        }

        shopRepository.merge(shop, req.body);
        const result = await shopRepository.save(shop);
        res.status(200).json(result);
    } catch (error) {
        res.status(500).json({ error: 'Failed to update shop' });
    }
});

// Delete shop
router.delete('/:id', auth, async (req: Request, res: Response) => {
    try {
        const shop = await shopRepository.findOne({
            where: { id: parseInt(req.params.id) },
            relations: ['employees']
        });

        if (!shop) {
            return res.status(404).json({ error: 'Shop not found' });
        }

        if (shop.employees?.length > 0) {
            return res.status(400).json({ error: 'Cannot delete shop with employees' });
        }

        await shopRepository.remove(shop);
        res.status(200).json({ message: 'Shop deleted' });
    } catch (error) {
        res.status(500).json({ error: 'Failed to delete shop' });
    }
});

export default router;

================
File: server/src/routes/timeEntries.ts
================
import { Router, Request, Response } from 'express';
import { AppDataSource } from '../database';
import { TimeEntry } from '../entities/TimeEntry';
import { Employee } from '../entities/Employee';
import { auth } from '../middleware/auth';

const router = Router();
const timeEntryRepo = AppDataSource.getRepository(TimeEntry);
const employeeRepo = AppDataSource.getRepository(Employee);

// ... other routes

// Clock out route
router.put('/:id/clock-out', auth, async (req: Request, res: Response) => {
    try {
        const entry = await timeEntryRepo.findOne({
            where: { id: parseInt(req.params.id) },
            relations: ['employee']
        });

        if (!entry) {
            return res.status(404).json({ error: 'Time entry not found' });
        }

        if (entry.clockOut) {
            return res.status(400).json({ error: 'Already clocked out' });
        }

        entry.clockOut = new Date();

        // Make sure we have the employee and hourlyRate
        if (!entry.employee || typeof entry.employee.hourlyRate !== 'number') {
            return res.status(400).json({ error: 'Invalid employee data' });
        }

        // Calculate hours worked
        const hoursWorked = (entry.clockOut.getTime() - entry.clockIn.getTime()) / (1000 * 60 * 60);

        // Calculate earnings using null coalescing to ensure we have a number
        entry.earnings = hoursWorked * (entry.employee.hourlyRate ?? 0);

        await timeEntryRepo.save(entry);
        res.json(entry);
    } catch (error) {
        console.error('Clock out error:', error);
        res.status(500).json({ error: 'Failed to clock out' });
    }
});

export default router;

================
File: server/src/types/express/index.d.ts
================
import { User } from '../../entities/User';

declare global {
    namespace Express {
        interface Request {
            user?: {
                userId: number;
                role: string;
            }
        }
    }
}

export {};

================
File: server/src/app.ts
================
import 'reflect-metadata';
import express from 'express';
import cors from 'cors';
import { initializeDatabase } from './database';
import authRoutes from './routes/auth';
import employeeRoutes from './routes/employees';
import timeEntryRoutes from './routes/timeEntries';
import shopRoutes from './routes/shops';
import dashboardRoutes from './routes/dashboard';

const app = express();

app.use(cors({
    origin: 'http://localhost:5173',
    credentials: true
}));

app.use(express.json());

// API Routes
app.use('/api/auth', authRoutes);
app.use('/api/employees', employeeRoutes);
app.use('/api/time-entries', timeEntryRoutes);
app.use('/api/shops', shopRoutes);
app.use('/api/dashboard', dashboardRoutes);

const PORT = process.env.PORT || 5000;

const startServer = async () => {
    try {
        await initializeDatabase();
        app.listen(PORT, () => console.log(`Server running on port ${PORT}`));
    } catch (error) {
        console.error('Server startup failed:', error);
        process.exit(1);
    }
};

startServer();

export default app;

================
File: server/src/config.ts
================
import dotenv from 'dotenv';
import path from 'path';

dotenv.config();

export const config = {
    port: process.env.PORT || 5000,
    jwt: {
        secret: process.env.JWT_SECRET || 'default-secret-key',
        expiry: process.env.JWT_EXPIRY || '24h'
    },
    db: {
        path: process.env.DB_PATH || path.join(__dirname, '..', 'database.sqlite'),
        synchronize: process.env.NODE_ENV === 'development'
    },
    cors: {
        origin: process.env.FRONTEND_URL || 'http://localhost:5173'
    }
};

================
File: server/src/data-source.ts
================
import { DataSource } from "typeorm";
import { User } from "./entities/User";
import { Employee } from "./entities/Employee";
import { TimeEntry } from "./entities/TimeEntry";
import { Shop } from "./entities/Shop";
import { config } from "./config";

export const AppDataSource = new DataSource({
    type: "sqlite",
    database: config.db.path,
    synchronize: config.db.synchronize,
    logging: true,
    entities: [User, Employee, TimeEntry, Shop],
    migrations: ["src/migrations/*.ts"]
});

================
File: server/src/database.ts
================
import { DataSource } from "typeorm";
import { User } from "./entities/User";
import { Employee } from "./entities/Employee";
import { TimeEntry } from "./entities/TimeEntry";
import { Shop } from "./entities/Shop";
import path from "path";
import bcrypt from 'bcrypt';

export const AppDataSource = new DataSource({
    type: "sqlite",
    database: path.join(__dirname, "..", "database.sqlite"),
    synchronize: true,
    logging: true,
    entities: [User, Employee, TimeEntry, Shop],
    migrations: [path.join(__dirname, "migrations", "*.{ts,js}")],
});

export const initializeDatabase = async (): Promise<boolean> => {
    try {
        if (!AppDataSource.isInitialized) {
            await AppDataSource.initialize();

            // Check and create admin user
            const userRepo = AppDataSource.getRepository(User);
            let adminUser = await userRepo.findOne({
                where: { email: 'kevin@cybercorelabs.co.za' }
            });

            if (!adminUser) {
                const hashedPassword = await bcrypt.hash('990309@Kevin', 10);
                adminUser = userRepo.create({
                    email: 'kevin@cybercorelabs.co.za',
                    password: hashedPassword,
                    role: 'admin'
                });
                await userRepo.save(adminUser);
                console.log('Admin user created successfully');
            }
        }
        return true;
    } catch (error) {
        console.error("Database initialization error:", error);
        return false;
    }
};

================
File: server/package.json
================
{
  "name": "server",
  "version": "1.0.0",
  "main": "dist/app.js",
  "scripts": {
    "start": "node dist/app.js",
    "dev": "nodemon --exec ts-node src/app.ts",
    "build": "tsc",
    "typeorm": "typeorm-ts-node-commonjs -d ./typeorm.config.ts",
    "migration:generate": "npm run typeorm -- migration:generate ./src/migrations/UpdateEmployeeSchema",
    "migration:run": "npm run typeorm -- migration:run",
    "migration:revert": "npm run typeorm -- migration:revert"
  },
  "dependencies": {
    "@types/bcrypt": "^5.0.2",
    "@types/cors": "^2.8.17",
    "@types/express": "^4.17.21",
    "@types/jsonwebtoken": "^9.0.5",
    "@types/multer": "^1.4.11",
    "@types/node": "^20.10.4",
    "bcrypt": "^5.1.1",
    "cors": "^2.8.5",
    "dotenv": "^16.3.1",
    "express": "^4.18.2",
    "jsonwebtoken": "^9.0.2",
    "multer": "^1.4.5-lts.1",
    "reflect-metadata": "^0.1.13",
    "sqlite3": "^5.1.6",
    "typeorm": "^0.3.17",
    "typescript": "^5.3.3"
  },
  "devDependencies": {
    "nodemon": "^3.0.2",
    "ts-node": "^10.9.2"
  }
}

================
File: server/tsconfig.json
================
{
  "compilerOptions": {
    "target": "es6",
    "module": "commonjs",
    "lib": ["es6"],
    "outDir": "./dist",
    "rootDir": "./src",
    "strict": true,
    "esModuleInterop": true,
    "skipLibCheck": true,
    "experimentalDecorators": true,
    "emitDecoratorMetadata": true,
    "strictPropertyInitialization": false,
    "resolveJsonModule": true
  },
  "include": ["src/**/*", "typeorm.config.ts"],
  "exclude": ["node_modules"]
}

================
File: server/typeorm.config.ts
================
import { DataSource } from "typeorm";
import { User } from "./src/entities/User";
import { Employee } from "./src/entities/Employee";
import { TimeEntry } from "./src/entities/TimeEntry";
import { Shop } from "./src/entities/Shop";
import path from "path";
import dotenv from "dotenv";

dotenv.config();

const dataSource = new DataSource({
    type: "sqlite",
    database: path.join(__dirname, "database.sqlite"),
    entities: [
        User,
        Employee,
        TimeEntry,
        Shop
    ],
    migrations: [path.join(__dirname, "src", "migrations", "*.{ts,js}")],
    synchronize: false,
    logging: true
});

export default dataSource;

================
File: .gitignore
================
# Dependencies
node_modules/
/.pnp
.pnp.js

# Testing
/coverage

# Production
/build
/dist

# Environment
.env
.env.local
.env.development.local
.env.test.local
.env.production.local

# Logs
npm-debug.log*
yarn-debug.log*
yarn-error.log*

# IDE
.idea/
.vscode/
*.swp
*.swo

# OS
.DS_Store
Thumbs.db
